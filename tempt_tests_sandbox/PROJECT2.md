# ボートレース「荒れ」予測モデル構築プラン

## 1. コンセプト
単に「誰が勝つか」を当てるのではなく、**「そのレースが定石通りに決まるか、それともアクシデントや大番狂わせが起きるか」**をメタ予測するモデルを構築する。

*   **定石展開（Standard）**: 人気上位（1番人気・2番人気など）が決着し、アクシデント（F/L等）がない。
*   **荒れ展開（Irregularity/Accident）**: 
    - 高配当（万舟券など）の発生
    - 事故（フライング、出遅れ、転覆等）の発生
    - 圧倒的人気選手（1号艇A1級など）の着外

## 2. 予測のターゲット（Target Variable）
*   **目的変数**: レース結果の「波乱度（Volatility）」
    - 0: 順当（払戻金が一定以下、かつ事故なし）
    - 1: 波乱（払戻金が一定以上、または事故あり）

## 3. 入力特徴量（Features）
### 3.1 レース環境
*   **天候**: 風速、波高（これらが一定以上だと波乱率が上がる）
*   **会場**: 水面特性（江戸川などの荒れやすい水面か、大村などの安定した水面か）
*   **時間帯**: 展示タイムと本番の乖離など

### 3.2 選手・機力
*   **事故率**: 過去のF/L履歴
*   **スタート能力**: 平均STと直近STの差
*   **モーター**: 2連対率、展示タイムの順位

### 3.3 オッズ（市場の期待）
*   **1番人気の支持率**: 支持率が高すぎるのに不安要素がある場合などは「荒れ」の予兆
*   **オッズの不整合**: 直前情報と売れ方の乖離

## 4. 開発ステップ
1.  **データ抽出**: `pyjpboatrace` を使い、過去の「払戻金」「事故履歴」「気象条件」を紐づけたデータセットを作成。
2.  **ラベリング**: 払戻金額の分布に基づき、何円以上の配当を「波乱」とするか閾値を決定。
3.  **モデル学習**: LightGBM等を用い、「荒れやすいレース」を識別する分類モデルを構築。
4.  **検証**: テストデータに対し、モデルが「波乱」と予測したレースで実際に高配当が出たか（または事故が起きたか）を評価。

---
## 5. 当面のタスク
- [ ] `boatrace.db` のスキーマを確認し、必要なデータ（払戻金、気象、事故）が揃っているか確認。
- [ ] 足りないデータを `pyjpboatrace` で収集するスクリプトを作成。